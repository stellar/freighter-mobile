appId: org.stellar.freighterdev
tags:
  - onboarding
  - import-wallet
---
- launchApp:
    clearState: true
    clearKeychain: true

# If iOS App Tracking Transparency prompt appears on first launch,
# choose "Ask App Not to Track"
- runFlow:
    when:
      visible:
        text: "Ask App Not to Track"
    commands:
      - tapOn:
          text: "Ask App Not to Track"

# Wait for welcome screen (may take time on first launch)
- extendedWaitUntil:
    visible:
      id: welcome-screen
    timeout: 600000 # 10 minutes (600 seconds = 600000 milliseconds)

# Tap import wallet button
- tapOn:
    id: import-wallet-button

# Enter password on Choose Password screen
- assertVisible:
    id: password-input
- tapOn:
    id: password-input
- inputText: "TestPassword123!"
- hideKeyboard

# Tap continue button
- tapOn:
    id: default-action-button

# Confirm password screen
- assertVisible:
    id: confirm-password-input
- tapOn:
    id: confirm-password-input
- inputText: "TestPassword123!"
- hideKeyboard

# Tap continue button
- tapOn:
    id: default-action-button

# Import wallet screen - enter recovery phrase
# Retry up to 3 times: clear field, type phrase slower (word-by-word), tap continue.
# Retries only if navigation doesn't happen after tapping continue (e.g., invalid phrase due to skipped letters).
# Handles flaky inputText (e.g. skipped letters) when simulator types too fast.
- retry:
    maxRetries: 3
    commands:
      - assertVisible:
          id: import-wallet-input
      - tapOn:
          id: import-wallet-input
      # Clear any existing text (iOS workaround: long press -> Select All -> erase)
      - longPressOn:
          id: import-wallet-input
      - runFlow:
          when:
            visible:
              text: "Select All|Select all"
          commands:
            - tapOn:
                text: "Select All|Select all"
      - eraseText: 100
      # Type phrase word-by-word with short pauses to avoid skipped characters
      - inputText: "mushroom "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "uncover "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "sail "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "prevent "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "spot "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "theory "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "work "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "inflict "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "arctic "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "figure "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "dish "
      - waitForAnimationToEnd:
          timeout: 150
      - inputText: "surround"
      # Tap continue/import button
      - tapOn:
          id: default-action-button
      # Verify navigation occurred - if we're still on import screen, this will fail and trigger retry
      - extendedWaitUntil:
          notVisible:
            id: import-wallet-input
          timeout: 15000

# Biometrics screen - skip biometrics if it appears
- runFlow:
    when:
      visible:
        text: .*biometric.*|.*Face ID.*|.*Touch ID.*|.*Enable.*
    commands:
      # Prefer tapping an explicit "Skip" / secondary action button if present
      - runFlow:
          when:
            visible:
              id: secondary-action-button
          commands:
            - tapOn:
                id: secondary-action-button
      # Fallback to common textual variants for skipping biometrics
      - runFlow:
          when:
            visible:
              text: "Skip for now|Skip|Not now|Maybe later"
          commands:
            - tapOn:
                text: "Skip for now|Skip|Not now|Maybe later"
      # If a system biometric dialog appears, choose the negative option
      - runFlow:
          when:
            visible:
              text: "Don't Allow|Don’t Allow|Cancel"
          commands:
            - tapOn:
                text: "Don't Allow|Don’t Allow|Cancel"

# Verify we reached home screen
- extendedWaitUntil:
    visible:
      id: home-screen
    timeout: 30000
