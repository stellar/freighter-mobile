appId: org.stellar.freighterdev
tags:
  - transactions
  - swap
  - classic-token
---
# NOTE: This flow is currently excluded from CI (iOS and Android) due to testID-related
# issues. Further investigation is needed to fix component/testID lookups before re-enabling.
#
# Import funded wallet first to ensure we have a wallet with balances
# NOTE: you can comment this first ImportWallet.yaml runFlow section out to
# skip the import wallet flow when testing locally so you don't need to import
# the wallet every time.
- runFlow:
    file: ../onboarding/ImportFundedWallet.yaml

# Dismiss welcome banner if it appears after import
- runFlow:
    when:
      visible:
        id: welcome-banner-dismiss-button
    commands:
      - tapOn:
          id: welcome-banner-dismiss-button
      - extendedWaitUntil:
          visible:
            id: home-screen
          timeout: 10000

# Switch to testnet after import
- runFlow:
    file: ../walletconnect/SwitchToTestnet.yaml

# Verify we're on home screen after import
- assertVisible:
    id: home-screen

# Wait for accounts and balances to load (can take ~10s after import)
- extendedWaitUntil:
    visible:
      id: home-account-switcher
    timeout: 15000
- extendedWaitUntil:
    visible:
      id: icon-button-swap
    timeout: 15000

# Navigate to swap screen
- assertVisible:
    id: tab-tokens
- assertVisible:
    id: tab-collectibles
- tapOn:
    id: icon-button-swap

# Verify we're on swap amount screen
- assertVisible:
    id: swap-amount-screen

# Select "from" token (XLM)
- tapOn:
    id: swap-from-token-row
# Verify token selection screen
- assertVisible:
    id: swap-token-selection-content
# Select XLM
- tapOn:
    id: token-option-XLM

# Select "to" token (USDC)
- tapOn:
    id: swap-to-choose-token
# Verify token selection screen
- assertVisible:
    id: swap-token-selection-content
# Select USDC
- tapOn:
    id: token-option-USDC

# Enter amount: 0.0000001 using numeric keyboard
- assertVisible:
    id: swap-amount-screen
- tapOn:
    id: numeric-key-0
- tapOn:
    id: numeric-key-decimal
- repeat:
    times: 6
    commands:
      - tapOn:
          id: numeric-key-0
- tapOn:
    id: numeric-key-1

# Review and confirm swap
- tapOn:
    id: swap-continue-button
# Verify review sheet is visible
- extendedWaitUntil:
    visible:
      id: swap-review-sheet
    timeout: 30000
# Confirm the swap
- tapOn:
    id: swap-review-confirm-button
# Verify swap transaction success
- extendedWaitUntil:
    visible:
      id: swap-processing-screen
    timeout: 30000
# Wait for completion and tap Done
- extendedWaitUntil:
    visible:
      id: swap-processing-done-button
    timeout: 30000
- tapOn:
    id: swap-processing-done-button
# Verify Swapped on history screen
- extendedWaitUntil:
    visible: "XLM to USDC"
    timeout: 30000
