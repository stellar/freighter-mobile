appId: org.stellar.freighterdev
tags:
  - walletconnect
  - sign-message
  - e2e
---
# SignMessage E2E Test
#
# Tests the stellar_signMessage WalletConnect flow using the WCE2ES FAB
# (WalletConnect E2E Simulator) which injects mock events directly.
#
# Flow:
# 1. Import funded wallet
# 2. Switch to testnet
# 3. Tap WCE2ES FAB -> Sign Msg
# 4. Verify sign message modal appears
# 5. Approve the signature
# 6. Verify success
#
# Prerequisites:
# - IS_E2E_TEST=true in .env
# - E2E_TEST_FUNDED_RECOVERY_PHRASE set

#########################################
# SETUP: Import Funded Wallet
#########################################

- runFlow:
    file: ../onboarding/ImportFundedWallet.yaml

# Dismiss welcome banner if it appears
- runFlow:
    when:
      visible:
        id: welcome-banner-dismiss-button
    commands:
      - tapOn:
          id: welcome-banner-dismiss-button
      - extendedWaitUntil:
          visible:
            id: home-screen
          timeout: 10000

- assertVisible:
    id: home-screen

#########################################
# SETUP: Switch to Testnet
#########################################

- runFlow:
    file: ./SwitchToTestnet.yaml

#########################################
# STEP 1: Trigger Sign Message via FAB
#########################################

# Open the WCE2ES FAB menu
- tapOn:
    id: e2e-wc-fab

# Wait for the menu to expand
- extendedWaitUntil:
    visible:
      id: e2e-trigger-sign-message
    timeout: 3000

# Tap "Sign Msg" to trigger the mock signMessage event
- tapOn:
    id: e2e-trigger-sign-message

#########################################
# STEP 2: Verify Sign Message UI
#########################################

# Wait for the sign message bottom sheet to appear
- extendedWaitUntil:
    visible:
      id: sign-message-title
    timeout: 10000

# Verify the message display is visible
- assertVisible:
    id: message-display

#########################################
# STEP 3: Approve Signature
#########################################

# Tap the confirm button to approve
- tapOn:
    id: dapp-request-confirm-button

#########################################
# STEP 4: Verify Success
#########################################

# Wait for the bottom sheet to dismiss
- extendedWaitUntil:
    notVisible:
      id: sign-message-title
    timeout: 10000

# Verify we're back on home screen
- assertVisible:
    id: home-screen
