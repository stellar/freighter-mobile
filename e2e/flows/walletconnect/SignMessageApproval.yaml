appId: org.stellar.freighterdev
tags:
  - walletconnect
  - sign-message
  - e2e
---
# WalletConnect Sign Message E2E Flow - Approval
#
# Tests the complete stellar_signMessage approval path using the
# WCE2ES FAB (WalletConnect E2E Simulator).
#
# Steps:
# 1. Import wallet (setup)
# 2. Switch to testnet
# 3. Tap WCE2ES FAB -> Sign Msg
# 4. Verify sign message UI in detail
# 5. Approve and verify success
#
# Prerequisites:
# - IS_E2E_TEST=true in .env
# - E2E_TEST_FUNDED_RECOVERY_PHRASE set

#########################################
# SETUP: Import Wallet
#########################################

- runFlow:
    file: ../onboarding/ImportFundedWallet.yaml

# Dismiss welcome banner if it appears
- runFlow:
    when:
      visible:
        id: welcome-banner-dismiss-button
    commands:
      - tapOn:
          id: welcome-banner-dismiss-button
      - extendedWaitUntil:
          visible:
            id: home-screen
          timeout: 10000

- assertVisible:
    id: home-screen

#########################################
# SETUP: Switch to Testnet
#########################################

- runFlow:
    file: ./SwitchToTestnet.yaml

#########################################
# STEP 1: Trigger Sign Message via FAB
#########################################

# Open the WCE2ES FAB menu
- tapOn:
    id: e2e-wc-fab

- extendedWaitUntil:
    visible:
      id: e2e-trigger-sign-message
    timeout: 3000

- tapOn:
    id: e2e-trigger-sign-message

#########################################
# STEP 2: Verify Sign Message UI
#########################################

# Wait for message signing request bottom sheet
- extendedWaitUntil:
    visible:
      id: sign-message-title
    timeout: 10000

# Verify message display
- assertVisible:
    id: message-display

#########################################
# STEP 3: Approve Signing
#########################################

# Approve - tap the confirm button
- tapOn:
    id: dapp-request-confirm-button

#########################################
# STEP 4: Verify Success
#########################################

# Wait for the bottom sheet to dismiss
- extendedWaitUntil:
    notVisible:
      id: sign-message-title
    timeout: 10000

# Verify we're back on home screen
- assertVisible:
    id: home-screen
