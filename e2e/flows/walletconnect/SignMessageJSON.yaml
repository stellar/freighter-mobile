appId: org.stellar.freighterdev
tags:
  - walletconnect
  - sign-message
  - json
  - e2e
---
# WalletConnect Sign Message E2E Flow - JSON Message
#
# Tests JSON message formatting using the WCE2ES FAB.
#
# Steps:
# 1. Import wallet (setup)
# 2. Switch to testnet
# 3. Tap WCE2ES FAB -> Sign JSON
# 4. Verify JSON is displayed with proper formatting
# 5. Approve and verify
#
# Prerequisites:
# - IS_E2E_TEST=true in .env
# - E2E_TEST_FUNDED_RECOVERY_PHRASE set

#########################################
# SETUP: Import Wallet
#########################################

- runFlow:
    file: ../onboarding/ImportFundedWallet.yaml

# Dismiss welcome banner if it appears
- runFlow:
    when:
      visible:
        id: welcome-banner-dismiss-button
    commands:
      - tapOn:
          id: welcome-banner-dismiss-button
      - extendedWaitUntil:
          visible:
            id: home-screen
          timeout: 10000

- assertVisible:
    id: home-screen

#########################################
# SETUP: Switch to Testnet
#########################################

- runFlow:
    file: ./SwitchToTestnet.yaml

#########################################
# STEP 1: Trigger Sign JSON via FAB
#########################################

# Open the WCE2ES FAB menu
- tapOn:
    id: e2e-wc-fab

- extendedWaitUntil:
    visible:
      id: e2e-trigger-sign-message-json
    timeout: 3000

# Tap "Sign JSON" to trigger JSON message signing
- tapOn:
    id: e2e-trigger-sign-message-json

#########################################
# STEP 2: Verify JSON Formatting
#########################################

# Wait for sign message bottom sheet
- extendedWaitUntil:
    visible:
      id: sign-message-title
    timeout: 10000

# Verify message display
- assertVisible:
    id: message-display

#########################################
# STEP 3: Approve Signing
#########################################

# Tap the confirm button
- tapOn:
    id: dapp-request-confirm-button

#########################################
# STEP 4: Verify Success
#########################################

# Wait for modal to dismiss
- extendedWaitUntil:
    notVisible:
      id: sign-message-title
    timeout: 10000

# Verify we're back on home
- assertVisible:
    id: home-screen
