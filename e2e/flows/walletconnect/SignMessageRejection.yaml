appId: org.stellar.freighterdev
tags:
  - walletconnect
  - sign-message
  - rejection
  - e2e
---
# WalletConnect Sign Message E2E Flow - Rejection
#
# Tests user rejection of signMessage request using the WCE2ES FAB.
#
# Steps:
# 1. Import wallet (setup)
# 2. Switch to testnet
# 3. Tap WCE2ES FAB -> Sign Msg
# 4. Cancel/Reject the request
# 5. Verify bottom sheet dismisses
#
# Prerequisites:
# - IS_E2E_TEST=true in .env
# - E2E_TEST_FUNDED_RECOVERY_PHRASE set

#########################################
# SETUP: Import Wallet
#########################################

- runFlow:
    file: ../onboarding/ImportFundedWallet.yaml

# Dismiss welcome banner if it appears
- runFlow:
    when:
      visible:
        id: welcome-banner-dismiss-button
    commands:
      - tapOn:
          id: welcome-banner-dismiss-button
      - extendedWaitUntil:
          visible:
            id: home-screen
          timeout: 10000

- assertVisible:
    id: home-screen

#########################################
# SETUP: Switch to Testnet
#########################################

- runFlow:
    file: ./SwitchToTestnet.yaml

#########################################
# STEP 1: Trigger Sign Message via FAB
#########################################

# Open the WCE2ES FAB menu
- tapOn:
    id: e2e-wc-fab

- extendedWaitUntil:
    visible:
      id: e2e-trigger-sign-message
    timeout: 3000

- tapOn:
    id: e2e-trigger-sign-message

#########################################
# STEP 2: Verify Modal Appears
#########################################

# Wait for the sign message bottom sheet
- extendedWaitUntil:
    visible:
      text: "Sign message"
    timeout: 10000

- assertVisible:
    text: "Stellar Signed Message:"

#########################################
# STEP 3: Reject/Cancel Request
#########################################

# Scroll to see the Cancel button
- scrollUntilVisible:
    element:
      text: "Cancel"
    direction: DOWN
    timeout: 5000

# Tap Cancel button
- tapOn:
    text: "Cancel"

#########################################
# STEP 4: Verify Rejection
#########################################

# Bottom sheet should close
- extendedWaitUntil:
    notVisible:
      text: "Sign message"
    timeout: 10000

# Verify we're back on home screen
- assertVisible:
    id: home-screen
