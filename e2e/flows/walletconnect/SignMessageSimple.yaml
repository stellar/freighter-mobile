appId: org.stellar.freighterdev
tags:
  - walletconnect
  - sign-message
  - e2e
  - simple
---
# WalletConnect Sign Message E2E Flow - Simplified (WCE2ES FAB)
#
# This flow tests the complete stellar_signMessage approval path using
# the WCE2ES FAB which injects mock events directly into the store.
# No mock WalletConnect server needed.
#
# Steps:
# 1. Import funded wallet (setup)
# 2. Switch to testnet
# 3. Tap WCE2ES FAB -> Sign Msg
# 4. Approve the request
# 5. Verify success
#
# Prerequisites:
# - IS_E2E_TEST=true in .env
# - E2E_TEST_FUNDED_RECOVERY_PHRASE set

#########################################
# SETUP: Import Wallet
#########################################

- runFlow:
    file: ../onboarding/ImportFundedWallet.yaml

# Dismiss welcome banner if it appears
- runFlow:
    when:
      visible:
        id: welcome-banner-dismiss-button
    commands:
      - tapOn:
          id: welcome-banner-dismiss-button
      - extendedWaitUntil:
          visible:
            id: home-screen
          timeout: 10000

- assertVisible:
    id: home-screen

#########################################
# SETUP: Switch to Testnet
#########################################

- runFlow:
    file: ./SwitchToTestnet.yaml

#########################################
# STEP 1: Trigger Sign Message via FAB
#########################################

# Open the WCE2ES FAB menu
- tapOn:
    id: e2e-wc-fab

- extendedWaitUntil:
    visible:
      id: e2e-trigger-sign-message
    timeout: 3000

- tapOn:
    id: e2e-trigger-sign-message

#########################################
# STEP 2: Verify & Approve
#########################################

# Wait for sign message bottom sheet - use testID instead of text
- extendedWaitUntil:
    visible:
      id: sign-message-title
    timeout: 10000

# Verify message display exists
- assertVisible:
    id: message-display

# Approve - tap the confirm button
- tapOn:
    id: dapp-request-confirm-button

#########################################
# STEP 3: Verify Success
#########################################

# Wait for the bottom sheet to dismiss
- extendedWaitUntil:
    notVisible:
      id: sign-message-title
    timeout: 10000

- assertVisible:
    id: home-screen
