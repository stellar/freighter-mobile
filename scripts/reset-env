#!/bin/bash

export LANG=en_US.UTF-8
echo ''
echo 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'
echo 'โ  ๐งน RESET ENVIRONMENT - Deep Clean All Dependencies        โ'
echo 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'
echo ''

# Step 1: Clean Gradle/Android
echo '๐ฑ Step 1/7: Cleaning Android/Gradle build artifacts...'
sh ./scripts/gradle-clean;
echo ''

# Step 2: Delete node_modules
echo '๐ฆ Step 2/7: Cleaning node_modules (this may take 30-60 seconds)...'
if [ -d "node_modules" ]; then
  find node_modules -depth -delete 2>/dev/null
  if [ -d "node_modules" ]; then
    chmod -R u+w node_modules 2>/dev/null
    rm -rf node_modules 2>/dev/null
  fi
  if [ ! -d "node_modules" ]; then
    echo '   โ node_modules cleaned'
  fi
else
  echo '   โ node_modules already clean'
fi
echo ''

# Step 3: Clean temporary files
echo '๐๏ธ  Step 3/7: Cleaning temporary React Native and npm caches...'
rm -rf $TMPDIR/react-* 2>/dev/null;
rm -rf $TMPDIR/npm-* 2>/dev/null;
echo '   โ Temporary files cleaned'
echo ''

# Step 4: Clean iOS
echo '๐ Step 4/7: Cleaning iOS dependencies and caches...'
cd ios;
rm -rf Pods;
rm -rf Podfile.lock;
rm -rf build;
echo '   โ iOS Pods and build artifacts cleaned'
echo ''

# Step 5: Clean npm cache
echo '๐ฆ Step 5/7: Cleaning npm cache...'
npm cache clean --force;
echo '   โ npm cache cleaned'
echo ''

# Step 6: Clean Pod cache
echo 'โ Step 6/7: Cleaning Pod cache...'
pod cache clean --all;
echo '   โ pod cache cleaned'
echo ''

# Step 7: Clean Android build
echo '๐ค Step 7/7: Cleaning Android build directory...'
cd ../android;
rm -rf build;
echo '   โ Android build cleaned'

# Clean Xcode caches
cd ..;
echo ''
echo '๐งน Removing Xcode DerivedData and CocoaPods files...'
rm -rf ~/Library/Developer/Xcode/DerivedData 2>/dev/null;
rm -rf "${HOME}/Library/Caches/CocoaPods" 2>/dev/null;
rm -rf "`pwd`/Pods/" 2>/dev/null;
echo '   โ Xcode & CocoaPods files removed'

echo ''
echo 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'
echo 'โ  โ ENVIRONMENT RESET COMPLETE!                            โ'
echo 'โ  Run "yarn install" to reinstall all dependencies          โ'
echo 'โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ'
echo ''